<!doctype html>
<html lang="en">
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
    <title>Imp</title>
    <link rel="stylesheet" href="./index.css">
  </head>
  <body style="margin: 1em auto auto auto; padding: 0; width: 80vw">

    <script>
      delete WebAssembly.instantiateStreaming;
    </script>

    <script src='pkg/imp_demo.js'></script>

    <script type=module>
      const { add } = wasm_bindgen;
      async function run() {
        await wasm_bindgen('./pkg/imp_demo_bg.wasm');
      }
      run();
    </script>

    <div class="imp-repl">
      <textarea style="width: 100%; height: 4em;"></textarea>
    </div>

    <div class="imp-render">
      <textarea style="width: 100%; height: 0.2em;">
result ->

let node = tag props children -> {
  "tag" x tag |
  "props" x props |
  "children" x children
} in

if is_function result then node "span" {nothing} {as_text result} else

let is_something = $result = something in
let result = pivot result in
let rows = if is_something then 1 else result (r c v -> r) in
let cols = result (r c v -> c) in

let table = node "table" in
let table_row = node "tr" in
let table_cell = node "td" in
let table_header = node "th" in

table {nothing} {
  0 x (table_row {nothing} {
    (0 x (table_cell {"style" x "border-right: solid 1px; border-bottom: solid 1px; height: 1em; min-width: 1em;"} {nothing}))
    |
    (cols (col -> col x table_cell {"style" x "border-bottom: solid 1px; height: 1em; min-width: 1em;"} {nothing}))
  })
  |
  (rows (row -> row x table_row {nothing} {
    (0 x (table_cell {"style" x "border-right: solid 1px; height: 1em; min-width: 1em;"} {nothing}))
    |
    (cols (col -> col x table_cell {nothing} {as_text (result row col)}))
  }))
}
      </textarea>
    </div>

    <div class="imp-result">
      <pre style="white-space: pre-wrap"></pre>
    </div>

  </body>
</html>
